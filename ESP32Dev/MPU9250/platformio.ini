; PlatformIO Project Configuration File
;
; Serial port가 안될 때 테스트 용도로 사용
; 
; Arduino Nano ESP32 부트로더 진입 방법 (수정)
; Arduino Nano ESP32는 BOOT0 버튼 하나만 있습니다.

; 방법 2: 더블탭 부트로더 (권장)

; BOOT0 버튼을 빠르게 두 번 누르기 (더블클릭)
; 보드의 LED가 천천히 깜빡이면 부트로더 모드 진입 성공
; 업로드 실행

; 방법 3: 업로드 시작과 동시에

; 업로드 명령 실행
; "Connecting..." 메시지가 나타나면 즉시 BOOT0 버튼 누르기
; 연결될 때까지 계속 누르고 있기

[env:arduino_nano_esp32]
platform = espressif32
board = arduino_nano_esp32
framework = arduino

; [env:esp32dev]
; platform = espressif32
; board = esp32dev          ; 일반 ESP32-DevKit(WROOM-32) 보드
; framework = arduino

; ===== 업로드 설정 =====
upload_protocol = esptool
; upload_port = COM9
upload_speed = 460800

; ===== 모니터 설정 =====
; monitor_port = COM10
monitor_speed = 115200
monitor_filters = esp32_exception_decoder

; ===== 빌드 플래그 =====
build_flags = 
  -DARDUINO_USB_CDC_ON_BOOT=1
  -DARDUINO_USB_MODE=1

; ✅✅✅ 이 줄을 완전히 삭제하거나 주석 처리! ✅✅✅
; board_build.partitions = partitions.csv

; ===== 빌드 최적화 =====
; build_type = release

; 업로드 후 자동으로 시리얼 모니터 시작
targets = upload, monitor

; ===== 사용 순서 =====
; 1. pio run -t upload(COM9 상태: RST LED 보라색 상태: RST 버튼 두 번 연속 누르기)
; 2. USB Cable 분리 후 재 연결(USER LED 켜지거나 깜빡임 상태)
; 3. pio device monitor(COM10(CDC) 나타난 상태)
; 4. 이렇게 하면 setup() 상태 모니터링 안된다.

; # 플래시 완전 삭제
; pio run -t erase --upload-port COM9

; ; # 업로드
; pio run -t upload --upload-port COM9

; ; # USB 재연결

; ; # 모니터(NOK)
; pio device monitor -p COM10 -b 115200

; ; # 모니터(OK)
; COM10 생성되지 않았는데 loop() 실행된다.
; pio device monitor

; ===== 사용 방법 =====
; 1. partitions.csv 파일 삭제
; 2. pio run -t clean
; 3. pio run -t erase --upload-port COM9
; 4. pio run -t upload --upload-port COM9
; 5. LED 확인!